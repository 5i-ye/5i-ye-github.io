---
title: Clustering(êµ°ì§‘í™”)ì˜ ëª¨ë“  ê²ƒ
date: 2024-04-13
categories: [ML]
tags: [Clustering]     # TAG names should always be lowercase
math: true
mermaid: true # ê·¸ë˜í”„ ë„êµ¬
image:
  path: 'https://github.com/5iye/covidPredict/assets/164887360/b9a83ad5-9703-4c7b-a1f9-23526dc03041'
#   alt: image alternative text
---
### **êµ°ì§‘í™” í•  ë•Œ ê²°ì •í•´ì•¼í•  ê²ƒ**

1. ë°ì´í„° ê°„ì˜ <span style="color:red">ê±°ë¦¬</span>ë¥¼ ì–´ë–»ê²Œ ì¸¡ì •í•  ê±°ëƒ
2. ì–´ë–¤ êµ°ì§‘í™” <span style="color:red">ë°©ë²•</span>ì„ ì‚¬ìš©í•  ê±°ëƒ
3. êµ°ì§‘ì˜ <span style="color:red">ê°œìˆ˜</span>ë¥¼ ì–´ë–»ê²Œ ê²°ì •í•  ê±°ëƒ

## 1.  ê±°ë¦¬ ì¸¡ì • ë°©ë²•

### **ìœ í´ë¦¬ë“œ ê±°ë¦¬ ì´ìš©**

$$
d(X, Y) = \sqrt{\sum\limits_{i=1}^n (X_i - Y_i)^2}
$$

### **ìƒê´€ê³„ìˆ˜ ê±°ë¦¬ ì´ìš©**

$$
d_{corr}(X, Y) = 1-ğœ_{xy}, -1 \leq ğœ_{xy} \leq 1
$$

![ìƒê´€ê³„ìˆ˜](https://github.com/5iye/covidPredict/assets/164887360/7eb092a7-13ac-45e2-84bb-9030ff7d7f85){: width="400" height="150"}
```python
array # (n_êµ°ì§‘, n_feature)
corr_matrix = pd.DataFrame(array).T.corr()
dis = 1-corr_matrix
```

### **ì½”ì‚¬ì¸ ê±°ë¦¬ ì´ìš©**

$$
d_{cos}(X,Y) = 1-cos\theta
$$

$$
\cos\theta = \frac{A \cdot B}{\left\|\ A \right\| \left\|\ B \right\|} = \frac {\sum_{i=1}^n A_i \times B_i}{\sqrt{\sum_{i=1}^n (A_i)^2} \times \sqrt{\sum_{i=1}^n (B_i)^2}}
$$

![ì½”ì‚¬ì¸ ìœ ì‚¬ë„](https://github.com/5iye/covidPredict/assets/164887360/3338f9d3-7b4a-4e7e-9f4b-56491b618e64)

```python
from sklearn.metrics.pairwise import cosine_similarity

cos_matrix = cosine_similarity(arr)
dis = 1-cos_matrix
```

## 2. êµ°ì§‘í™” ë°©ë²•

### **K-means**

- ë°©ë²•ë¡ 
    
    ![kmeans](https://github.com/5iye/covidPredict/assets/164887360/f1f163dc-4719-4d04-8182-2484d74947fb)
    
    1. kê°œì˜ ì„ì˜ì˜ ì¤‘ì‹¬ê°’ì„ ê³ ë¥¸ë‹¤. 
    2. ì¤‘ì‹¬ê°’ê¹Œì§€ ê±°ë¦¬ ê³„ì‚°ì„ í†µí•´ cluster í• ë‹¹í•œë‹¤.
    3. clusterì— ì†í•œ ë°ì´í„°ë“¤ì˜ í‰ê· ê°’ìœ¼ë¡œ ì¤‘ì‹¬ê°’ ì´ë™í•œë‹¤.
    4. ë°ì´í„°ì— ëŒ€í•œ cluster í• ë‹¹ì´ ë³€í•˜ì§€ ì•Šì„ ë•Œê¹Œì§€ ë°˜ë³µí•œë‹¤.

- ì½”ë“œ
    
    ```python
    from sklearn.cluster import KMeans
    
    # n_clusters == k
    kmeans = KMeans(n_clusters, init='random')   # init: ë””í´íŠ¸ k-means++ (ê·¸ëŸ´ë“¯í•œ ìœ„ì¹˜ì—)
    kmeans.fit(x)
    
    kmeans.labels_               # í•™ìŠµì´ ëë‚œ í›„ í• ë‹¹ëœ cluster
    kmeans.cluster_centers_      # í•™ìŠµì´ ëë‚¬ì„ ë•Œ ì¤‘ì‹¬ê°’ í™•ì¸
    
    kmeans.predict(x_test)       # ìƒˆë¡œìš´ ë°ì´í„° ì˜ˆì¸¡
    ```
    

### **Hierarchical_clustering (ê³„ì¸µì  êµ°ì§‘ ë¶„ì„)**

**ä¸­ AgglomerativeClustering (ìƒí–¥ì‹, ì‘ì§‘í˜•)**

- ë°©ë²•ë¡ 
    1. ê° ë…¸ë“œë¥¼ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¼ê³  ìƒê°í•˜ê³  ê±°ë¦¬ê°€ ê°€ê¹Œìš´ ê²ƒë¼ë¦¬ ë¬¶ëŠ”ë‹¤.
    2. 1ë²ˆì„ ë°˜ë³µí•œë‹¤.
    
    ì´ë•Œ, ë¬¶ëŠ” ë°©ë²• ì¤‘ í•˜ë‚˜ì¸ â€˜wardâ€™ ë€, <span style="background-color:#fff5b1">ë‘ êµ°ì§‘ì´ í•©ì³ì¡Œì„ ë•Œ ì˜¤ì°¨ ì œê³±í•©ì˜ ì¦ê°€ë¶„</span>ì„ ê±°ë¦¬ë¡œ ì¸¡ì •í•œë‹¤.
    
    - ë…¸ì´ì¦ˆë‚˜ ì´ìƒì¹˜ì— ëœ ë¯¼ê°í•¨, ë¹„ìŠ·í•œ í¬ê¸°ì˜ êµ°ì§‘ë¼ë¦¬ ë¬¶ì–´ì¤Œ
        ![ward](https://github.com/5iye/covidPredict/assets/164887360/b9a83ad5-9703-4c7b-a1f9-23526dc03041){: width="400" height="250"}{: left }
        
- ì½”ë“œ
    
    ```python
    from sklearn.cluster import AgglomerativeClustering
    
    cluster = AgglomerativeClustering(n_clusters=k, linkage='ward')
    labels = cluster.fit_predict(matrix)
    ```
    

- ì‹œê°í™” - dendrogram
    
    ```python
    from scipy.cluster.hierarchy import dendrogram, linkage
    
    Z = linkage(matrix, 'ward')
    plt.figure(figsize=(10, 5))
    dendrogram(Z)
    plt.show()
    ```
    
    ![dendrogram](https://github.com/5iye/covidPredict/assets/164887360/a1fcd71c-fc7f-4883-bb7c-fdd196a0bb83)
    

## 3. ìµœì  í´ëŸ¬ìŠ¤í„° ê°œìˆ˜(k) ì°¾ê¸°

### ì—˜ë³´ìš° ê¸°ë²•

ê° ë°ì´í„°ë§ˆë‹¤ ìì‹ ì´ ì†í•œ cluster ì˜ ì¤‘ì‹¬ê°’ê¹Œì§€ì˜ ê±°ë¦¬ì˜ ì œê³±ì˜ í•©(inertia)ì„ ê³„ì‚° 

â†’ ì˜ ì ìš©ëœ clusterë¼ë©´ ê±°ë¦¬ê°€ ì§§ìŒ, ì„œë¡œ ë‹¤ë¥¸ clusterë¼ë¦¬ ì–¼ë§ˆë‚˜ ë–¨ì–´ì ¸ ìˆëŠ”ì§€ì— ëŒ€í•œ ì •ë³´ê°€ ì—†ìŒ

![elbow](https://github.com/5iye/covidPredict/assets/164887360/4eb285d0-c82d-4a31-8477-839b7789497d)

```python
from sklearn.cluster import KMeans
from yellowbrick.cluster import KElbowVisualizer

k=0
kmeans = KMeans(n_clusters=k, random_state=7)
visualizer = KElbowVisualizer(kmeans, k=(1,10), timings=False)
visualizer.fit(arr1)
visualizer.show()
```

### **ì‹¤ë£¨ì—£(silhouette)**Â ê¸°ë²•

$$
s^i = \frac{b^i - a^i}{max\{a^i, b^i\}}
$$

a: í´ëŸ¬ìŠ¤í„° ë‚´ ë°ì´í„° **ì‘ì§‘ë„(cohesion) **

= ë°ì´í„° x(i)ì™€Â <span style="color:yellowgreen">ë™ì¼í•œ í´ëŸ¬ìŠ¤í„° </span>ë‚´ì˜ ë‚˜ë¨¸ì§€ ë°ì´í„°ë“¤ê³¼ì˜ í‰ê·  ê±°ë¦¬ (ì´ìƒì : 0)

b: í´ëŸ¬ìŠ¤í„° ê°„ **ë¶„ë¦¬ë„(separation) **

= ë°ì´í„° x(i)ì™€Â <span style="color:yellowgreen">ê°€ì¥ ê°€ê¹Œìš´ í´ëŸ¬ìŠ¤í„° </span>ë‚´ì˜ ëª¨ë“  ë°ì´í„°ë“¤ê³¼ì˜ í‰ê·  ê±°ë¦¬ (ì»¤ì§ˆìˆ˜ë¡ ì¢‹ìŒ)

â†’ <span style="background-color:#fff5b1">1(ê°€ì¥ ì´ìƒì ì¸ ê°’)ì— ê°€ê¹Œìš¸ìˆ˜ë¡ </span>êµ°ì§‘í™”ê°€ ì˜ë˜ì—ˆë‹¤ê³  íŒë‹¨(0.7ì´ìƒ)

```python
from sklearn.metrics import silhouette_score, silhouette_samples
from sklearn.cluster import AgglomerativeClustering

for k in range(2, 10):
    agg = AgglomerativeClustering(n_clusters=k).fit(matrix)
    silhouette_avg = silhouette_score(matrix, agg.labels_)
    print(f'cluster : {k} // silhouette index {silhouette_avg}')

```